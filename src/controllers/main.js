var Media = require('../models').Media;
var MediaController = require('./media');

module.exports.initSocket = function (io, socket) {
	var socketId = socket.id;

	//io.set("transports", ["polling"]);
	//io.set("polling duration", 10);

	console.log("CONNECTED, socketId: ", socketId)

	socket.on('disconnect', function() {
		console.log('DISCONNECT, socketId:', socketId);
	});

    socket.on('join', function(publisherId){
        console.log('JOIN, publisherId:',publisherId);
        io.emit('much connect');
    });

    // Prepare initial data

	// Initialize conversation
	MediaController.generateInitialData(function(initData) {
	    io.emit('init', initData);
	});

};


module.exports.newSong = function (req, res, io) {
	console.log('newSONG!');

	MediaController.processSongUpdate(
		[{"user":{"id":5038646,"username":"ItzTart"},"media":{"author":"Hellberg & Teqq ft. Taylr Renee","format":1,"image":"//i1.ytimg.com/vi/powCHN8DdXA/default.jpg","cid":"powCHN8DdXA","duration":288,"title":"Air (Mr FijiWiji Remix) [Free Download]","id":"0"},"score":{"positive":198,"negative":3,"grabs":7,"listeners":702}},{"user":{"id":5276894,"username":"WolfheartDJ"},"media":{"author":"Vonikk","cid":"HLT2RYNqbv4","duration":348,"format":1,"id":"0","image":"//i.ytimg.com/vi/HLT2RYNqbv4/default.jpg","title":"Nova"},"score":{"grabs":12,"listeners":703,"negative":0,"positive":216,"skipped":0}},{"user":{"id":3466973,"username":"Aaeeschylus"},"media":{"author":"Hybrid Minds","cid":"jzI8O-enCxQ","duration":314,"format":1,"id":"0","image":"//i.ytimg.com/vi/jzI8O-enCxQ/default.jpg","title":"Lost"},"score":{"grabs":2,"listeners":703,"negative":1,"positive":177,"skipped":0}},{"user":{"id":4056566,"username":"HumanBeing101"},"media":{"author":"Hybrid","cid":"184184254","duration":268,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000102069854-vdz7ha-large.jpg","title":"Don't You See (Remastered)"},"score":{"grabs":14,"listeners":700,"negative":11,"positive":202,"skipped":0}},{"user":{"id":5739029,"username":"Kuhhn"},"media":{"author":"Noisestorm","cid":"xnrAw8L6S18","duration":251,"format":1,"id":"0","image":"//i.ytimg.com/vi/xnrAw8L6S18/default.jpg","title":"Surge (Drum & Bass Mix)"},"score":{"grabs":8,"listeners":708,"negative":0,"positive":202,"skipped":0}},{"user":{"id":3741930,"username":"schlurbi"},"media":{"author":"Keeno","cid":"erRDeoGYfpM","duration":316,"format":1,"id":"0","image":"//i.ytimg.com/vi/erRDeoGYfpM/default.jpg","title":"Scripted (VIP)"},"score":{"grabs":12,"listeners":704,"negative":0,"positive":202,"skipped":0}},{"user":{"id":3945770,"username":"MindlessFate"},"media":{"author":"MindlessFate","cid":"tDpawMKBgYo","duration":307,"format":1,"id":"0","image":"//i.ytimg.com/vi/tDpawMKBgYo/default.jpg","title":"Break of Day"},"score":{"grabs":5,"listeners":701,"negative":1,"positive":205,"skipped":0}},{"user":{"id":4105182,"username":"Astrocat"},"media":{"author":"Keeno","cid":"8RbHW1op8ZM","duration":270,"format":1,"id":"0","image":"//i.ytimg.com/vi/8RbHW1op8ZM/default.jpg","title":"Out of Nowhere"},"score":{"grabs":10,"listeners":706,"negative":1,"positive":204,"skipped":0}},{"user":{"id":3530208,"username":"MisterBanan"},"media":{"author":"Myk","cid":"PKr5UWhzSr8","duration":275,"format":1,"id":"0","image":"//i.ytimg.com/vi/PKr5UWhzSr8/default.jpg","title":"I'm Not Lost (Keeno Remix) (FREE)"},"score":{"grabs":8,"listeners":694,"negative":0,"positive":208,"skipped":0}},{"user":{"id":4031047,"username":"Cookiezi is a monster"},"media":{"author":"Matrix & Futurebound","cid":"MKQDzpIwAMo","duration":221,"format":1,"id":"0","image":"//i.ytimg.com/vi/MKQDzpIwAMo/default.jpg","title":"Magnetic Eyes (Ft. Baby Blue) (Official Video)"},"score":{"grabs":7,"listeners":700,"negative":5,"positive":203,"skipped":0}},{"user":{"id":4157922,"username":"Mr. Camel"},"media":{"author":"Linkin Park","cid":"fCDNpiJ25xQ","duration":274,"format":1,"id":"0","image":"//i.ytimg.com/vi/fCDNpiJ25xQ/default.jpg","title":"Numb (DJ Velchev Pavel Remix)"},"score":{"grabs":6,"listeners":695,"negative":12,"positive":201,"skipped":0}},{"user":{"id":4684278,"username":"Fungus"},"media":{"author":"Barely Alive","cid":"JCoPR77jmNc","duration":298,"format":1,"id":"0","image":"//i.ytimg.com/vi/JCoPR77jmNc/default.jpg","title":"Welcome To The Real World (feat. Diamond Eyes) (EH!DE Remix)"},"score":{"grabs":6,"listeners":698,"negative":0,"positive":194,"skipped":0}},{"user":{"id":3861821,"username":"NerdNation"},"media":{"author":"Drumstep - EDM.com","cid":"183009905","duration":226,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000101251111-23xayf-large.jpg","title":"Jarvis - Close My Eyes [EDM.com Premiere]"},"score":{"grabs":9,"listeners":691,"negative":0,"positive":201,"skipped":0}},{"user":{"id":4111553,"username":"Katie"},"media":{"author":"Koven","cid":"j411kQANAFI","duration":190,"format":1,"id":"0","image":"//i.ytimg.com/vi/j411kQANAFI/default.jpg","title":"Final Call"},"score":{"grabs":5,"listeners":700,"negative":0,"positive":194,"skipped":0}},{"user":{"id":3641332,"username":"KЯE3D"},"media":{"author":"Zerothree Music","cid":"186162072","duration":289,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000103426353-307nc3-large.jpg","title":"Suspect 44 Ft. Soar - I Feel It (Original Mix)Premiere"},"score":{"grabs":4,"listeners":690,"negative":0,"positive":187,"skipped":0}},{"user":{"id":4632410,"username":"Roisto"},"media":{"author":"TJH87","cid":"181037737","duration":211,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000099950801-loz3gn-large.jpg","title":"TJH87 - Show Out Feat. Soosh*e! [Free Download]"},"score":{"grabs":8,"listeners":684,"negative":1,"positive":191,"skipped":0}},{"user":{"id":3861821,"username":"NerdNation"},"media":{"author":"Excision & Pegboard Nerds","cid":"OYfl7fg5PRs","duration":206,"format":1,"id":"0","image":"//i.ytimg.com/vi/OYfl7fg5PRs/default.jpg","title":"Bring The Madness (feat. Mayor Apeshit)"},"score":{"grabs":3,"listeners":683,"negative":6,"positive":179,"skipped":1}},{"user":{"id":3898620,"username":"Snoopyhorse"},"media":{"author":"pheonixmmo","cid":"ONLtyZJ2uyA","duration":248,"format":1,"id":"0","image":"//i.ytimg.com/vi/ONLtyZJ2uyA/default.jpg","title":"Tristam Meets League of Legends (Dubstep) Community Music Video by PheonixMMO"},"score":{"grabs":7,"listeners":686,"negative":10,"positive":188,"skipped":0}},{"user":{"id":4558435,"username":"Kilobomb"},"media":{"author":"Shadow Child","cid":"DR8pX-APVYk","duration":361,"format":1,"id":"0","image":"//i.ytimg.com/vi/DR8pX-APVYk/default.jpg","title":"23 (ft. Tymer)"},"score":{"grabs":5,"listeners":701,"negative":2,"positive":198,"skipped":0}},{"user":{"id":5478437,"username":"WickedBone"},"media":{"author":"Skism","cid":"xiTWj5-dt7k","duration":164,"format":1,"id":"0","image":"//i.ytimg.com/vi/xiTWj5-dt7k/default.jpg","title":"Experts (HD)"},"score":{"grabs":0,"listeners":691,"negative":1,"positive":186,"skipped":0}},{"user":{"id":4558435,"username":"Kilobomb"},"media":{"author":"Kilobomb","cid":"186887035","duration":203,"format":2,"id":"0","image":"//cdn.plug.dj/_/static/images/soundcloud_thumbnail.c6d6487d52fe2e928a3a45514aa1340f4fed3032.png","title":"Boom"},"score":{"grabs":0,"listeners":691,"negative":0,"positive":78,"skipped":1}},{"user":{"id":2798405,"username":"520ea00cc3b97a47b1507e2c"},"media":{"author":"Pegboard Nerds & Tristam","cid":"1CS9JSoDuDg","duration":186,"format":1,"id":"0","image":"//i.ytimg.com/vi/1CS9JSoDuDg/default.jpg","title":"Razor Sharp (No Dubstep Cut)"},"score":{"grabs":8,"listeners":691,"negative":10,"positive":189,"skipped":0}},{"user":{"id":3583919,"username":"sinful"},"media":{"author":"XLR8R","cid":"83238079","duration":245,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000042935918-3aneq3-large.jpg?ca77017","title":"Pomrad \"Pomslap\""},"score":{"grabs":1,"listeners":692,"negative":7,"positive":188,"skipped":0}},{"user":{"id":3566409,"username":"ᴄᴄᴢᴀʙ"},"media":{"author":"Skrillex","cid":"Mq-aVCUs2Q0","duration":171,"format":1,"id":"0","image":"//i.ytimg.com/vi/Mq-aVCUs2Q0/default.jpg","title":"Dirty Vibe with Diplo, CL, & G-Dragon (OFFICIAL VIDEO)"},"score":{"grabs":5,"listeners":694,"negative":16,"positive":186,"skipped":0}},{"user":{"id":483718,"username":"Hi-One"},"media":{"author":"IAMNOBODI","cid":"180598479","duration":248,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000099625171-5i945x-large.jpg","title":"When You Know It (Hi-One Remix)  (ft. Katt Williams & DMX)"},"score":{"grabs":1,"listeners":700,"negative":15,"positive":193,"skipped":0}},{"user":{"id":3981366,"username":"RaptorJeebus"},"media":{"author":"Paris Blohm","cid":"185700559","duration":261,"format":2,"id":"0","image":"//i1.sndcdn.com/artworks-000103107473-fjnrhy-large.jpg","title":"Paris Blohm ft. Charles - Demons (OUT NOW)"},"score":{"grabs":5,"listeners":703,"negative":0,"positive":204,"skipped":0}},{"user":{"id":5357974,"username":"FoxKit"},"media":{"author":"Wolfgun","cid":"j_l7EQY7oR4","duration":328,"format":1,"id":"0","image":"//i.ytimg.com/vi/j_l7EQY7oR4/default.jpg","title":"Volk"},"score":{"grabs":4,"listeners":715,"negative":7,"positive":206,"skipped":0}},{"user":{"id":4664748,"username":"Donkeystone"},"media":{"author":"Nev Plays: Arty","cid":"hHMgxY5fjB0","duration":130,"format":1,"id":"0","image":"//i.ytimg.com/vi/hHMgxY5fjB0/default.jpg","title":"Up All Night (Launchpad Cup Song)"},"score":{"grabs":5,"listeners":705,"negative":0,"positive":201,"skipped":0}},{"user":{"id":3832143,"username":"TheAlinator_MK"},"media":{"author":"Arisen Flame","cid":"T9FbqSZRqUo","duration":382,"format":1,"id":"0","image":"//i.ytimg.com/vi/T9FbqSZRqUo/default.jpg","title":"Redemption (Original Mix)"},"score":{"grabs":3,"listeners":711,"negative":1,"positive":207,"skipped":0}},{"user":{"id":3420424,"username":"Emsify"},"media":{"author":"Amy Steele","cid":"x7ZSJwULmsA","duration":311,"format":1,"id":"0","image":"//i.ytimg.com/vi/x7ZSJwULmsA/default.jpg","title":"The Wolves (Koven Remix)"},"score":{"grabs":7,"listeners":711,"negative":0,"positive":205,"skipped":0}},{"user":{"id":3458379,"username":"Iamp"},"media":{"author":"Porter Robinson","cid":"2Pkhmpq1jhA","duration":301,"format":1,"id":"0","image":"//i.ytimg.com/vi/2Pkhmpq1jhA/default.jpg","title":"Sad Machine (Tut Tut Child Remix)"},"score":{"grabs":11,"listeners":717,"negative":3,"positive":214,"skipped":0}},{"user":{"id":4558435,"username":"Kilobomb"},"media":{"author":"Kilobomb","cid":"186873441","duration":192,"format":2,"id":"0","image":"//cdn.plug.dj/_/static/images/soundcloud_thumbnail.c6d6487d52fe2e928a3a45514aa1340f4fed3032.png","title":"Boom"},"score":{"grabs":0,"listeners":731,"negative":0,"positive":198,"skipped":0}},{"user":{"id":5790980,"username":"DjHunter"},"media":{"author":"[Dubstep]","cid":"DECxluN8OZM","duration":351,"format":1,"id":"0","image":"//i.ytimg.com/vi/DECxluN8OZM/default.jpg","title":"Au5 - Snowblind (feat. Tasha Baxter) [Monstercat Release]"},"score":{"grabs":10,"listeners":728,"negative":3,"positive":220,"skipped":0}},{"user":{"id":4799905,"username":"WaffIe"},"media":{"author":"Spag Heddy","cid":"avXQPMNIj-k","duration":204,"format":1,"id":"0","image":"//i.ytimg.com/vi/avXQPMNIj-k/default.jpg","title":"Love On First Sine"},"score":{"grabs":16,"listeners":733,"negative":4,"positive":212,"skipped":0}},{"user":{"id":5837041,"username":"LazyPanda4412"},"media":{"author":"Jetta","cid":"5hEh9LiSzow","duration":191,"format":1,"id":"0","image":"//i.ytimg.com/vi/5hEh9LiSzow/default.jpg","title":"I'd Love to Change the World (Matstubs Remix)"},"score":{"grabs":25,"listeners":728,"negative":1,"positive":224,"skipped":0}},{"user":{"id":5453893,"username":"gab_prata"},"media":{"author":"ASTR","cid":"yqHuSmAfL5s","duration":191,"format":1,"id":"0","image":"//i.ytimg.com/vi/yqHuSmAfL5s/default.jpg","title":"Hold On We're Going Home [Free DL]"},"score":{"grabs":8,"listeners":726,"negative":3,"positive":216,"skipped":0}},{"user":{"id":4473380,"username":"ChivenOn"},"media":{"author":"Vicetone","cid":"t3XPXiG51ng","duration":189,"format":1,"id":"0","image":"//i.ytimg.com/vi/t3XPXiG51ng/default.jpg","title":"No Way Out (ft. Kat Nestel)"},"score":{"grabs":12,"listeners":733,"negative":0,"positive":187,"skipped":0}},{"user":{"id":4799905,"username":"WaffIe"},"media":{"author":"TheFatRat","cid":"Bamvg4Icmi0","duration":232,"format":1,"id":"0","image":"//i.ytimg.com/vi/Bamvg4Icmi0/default.jpg","title":"Windfall [Tasty Release]"},"score":{"grabs":0,"listeners":730,"negative":0,"positive":109,"skipped":1}},{"user":{"id":4257275,"username":"theWub"},"media":{"author":"DILLON FRANCIS ft T.E.E.D","cid":"aKb9VQpoe_U","duration":267,"format":1,"id":"0","image":"//i.ytimg.com/vi/aKb9VQpoe_U/default.jpg","title":"Without You (Official Video)"},"score":{"grabs":8,"listeners":730,"negative":5,"positive":221,"skipped":0}},{"user":{"id":5729430,"username":"kevin0"},"media":{"author":"Krome and Time","cid":"rYZwf6UmhjM","duration":302,"format":1,"id":"0","image":"//i.ytimg.com/vi/rYZwf6UmhjM/default.jpg","title":"The Licence (Doctor P Remix)"},"score":{"grabs":4,"listeners":733,"negative":25,"positive":192,"skipped":1}},{"user":{"id":5013277,"username":"Illyasviel"},"media":{"author":"DJ Satomi","cid":"HxpTe1yP6gs","duration":223,"format":1,"id":"0","image":"//i.ytimg.com/vi/HxpTe1yP6gs/default.jpg","title":"Waves (Stefano Carparelli Remix)"},"score":{"grabs":11,"listeners":729,"negative":4,"positive":212,"skipped":0}},{"user":{"id":3723808,"username":">Padilha"},"media":{"author":"Skullee","cid":"ENGBDwd3LSg","duration":215,"format":1,"id":"0","image":"//i.ytimg.com/vi/ENGBDwd3LSg/default.jpg","title":"He's A Pirate"},"score":{"grabs":17,"listeners":732,"negative":6,"positive":223,"skipped":0}},{"user":{"id":3539273,"username":"lDan"},"media":{"author":"Hans Zimmer ft. Satellite Empire","cid":"aC2OdznjqKI","duration":294,"format":1,"id":"0","image":"//i.ytimg.com/vi/aC2OdznjqKI/default.jpg","title":"Time (The Machinist Remix)"},"score":{"grabs":17,"listeners":730,"negative":4,"positive":229,"skipped":0}},{"user":{"id":3587297,"username":"Evilanimeguy"},"media":{"author":"Coyote Kisses","cid":"wewjMEYTLZY","duration":221,"format":1,"id":"0","image":"//i.ytimg.com/vi/wewjMEYTLZY/default.jpg","title":"Six Shooter"},"score":{"grabs":8,"listeners":724,"negative":5,"positive":212,"skipped":0}},{"user":{"id":5013277,"username":"Illyasviel"},"media":{"author":"unravel feat. Hatsune Miku","cid":"jfn1L6QLCn8","duration":239,"format":1,"id":"0","image":"//i.ytimg.com/vi/jfn1L6QLCn8/default.jpg","title":"Dubstep [ dj-Jo Remix ] Full Version"},"score":{"grabs":1,"listeners":728,"negative":23,"positive":187,"skipped":1}},{"user":{"id":3628346,"username":"Frantix"},"media":{"author":"Tuneboy & Ruffian","cid":"nPaZGRQKySs","duration":267,"format":1,"id":"0","image":"//i.ytimg.com/vi/nPaZGRQKySs/default.jpg","title":"SOYM (2K14 Remix)"},"score":{"grabs":8,"listeners":728,"negative":6,"positive":224,"skipped":0}},{"user":{"id":3684611,"username":"Jkaan"},"media":{"author":"[Bounce]","cid":"-E4guPDy13k","duration":234,"format":1,"id":"0","image":"//i.ytimg.com/vi/-E4guPDy13k/default.jpg","title":"Paul Dluxx - Ardisia [Premiere]"},"score":{"grabs":6,"listeners":742,"negative":1,"positive":224,"skipped":0}},{"user":{"id":4700321,"username":"Jitsu"},"media":{"author":"U'Moon","cid":"V-500-bVUfs","duration":242,"format":1,"id":"0","image":"//i.ytimg.com/vi/V-500-bVUfs/default.jpg","title":"Ouch!"},"score":{"grabs":9,"listeners":743,"negative":1,"positive":193,"skipped":0}},{"user":{"id":5832930,"username":"catalyze"},"media":{"author":"Daft Punk vs Bingo Players vs Skrillex","cid":"uOdLRCJKiBc","duration":287,"format":1,"id":"0","image":"//i.ytimg.com/vi/uOdLRCJKiBc/default.jpg","title":"Technologic Rattle Devil (Loo & Placido Video Collage)"},"score":{"grabs":22,"listeners":746,"negative":12,"positive":235,"skipped":0}},{"user":{"id":3903500,"username":"SerraphiX"},"media":{"author":"Darwin & Defekt","cid":"LhvJHwErHtA","duration":335,"format":1,"id":"0","image":"//i.ytimg.com/vi/LhvJHwErHtA/default.jpg","title":"The Anthem (ft. Jeston Langland)"},"score":{"grabs":11,"listeners":754,"negative":1,"positive":240,"skipped":0}},{"user":{"id":5645570,"username":"liimiitss"},"media":{"author":"KDrew","cid":"L2NhfzcVmBA","duration":266,"format":1,"id":"0","image":"//i.ytimg.com/vi/L2NhfzcVmBA/default.jpg","title":"Circles (Original Mix)"},"score":{"grabs":11,"listeners":758,"negative":2,"positive":233,"skipped":0}}],
		function() {

			MediaController.generateInitialData(function(initData) {

				io.emit('song_change', initData);

				return res.send(initData);

			});

		}
	);

}

module.exports.player = function (req, res) {
	res.render('player');
}




